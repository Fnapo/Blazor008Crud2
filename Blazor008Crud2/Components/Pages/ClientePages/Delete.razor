@page "/clientes/delete"
@using Microsoft.EntityFrameworkCore
@using B007Clases.Models
@inject B007Clases.Data.B007CrudContext B007CrudContext;
@inject NavigationManager NavigationManager

<PageTitle>Delete</PageTitle>

<h1>Delete</h1>

<p>Are you sure you want to delete this?</p>
<div>
	<h2>Cliente</h2>
	<hr />
	@if (cliente is null)
	{
		<p><em>Loading...</em></p>
	}
	else
	{
		<dl class="row">
			<dt class="col-sm-2">Nombre</dt>
			<dd class="col-sm-10">@cliente.Nombre</dd>
		</dl>
		<dl class="row">
			<dt class="col-sm-2">Apellidos</dt>
			<dd class="col-sm-10">@cliente.Apellidos</dd>
		</dl>
		<dl class="row">
			<dt class="col-sm-2">Email</dt>
			<dd class="col-sm-10">@cliente.Email</dd>
		</dl>
		<dl class="row">
			<dt class="col-sm-2">Telefono</dt>
			<dd class="col-sm-10">@cliente.Telefono</dd>
		</dl>
		<!--
		<dl class="row">
			<dt class="col-sm-2">FechaAlta</dt>
			<dd class="col-sm-10">@cliente.FechaAlta</dd>
		</dl>
		<dl class="row">
			<dt class="col-sm-2">Creado</dt>
			<dd class="col-sm-10">@cliente.Creado</dd>
		</dl>
		<dl class="row">
			<dt class="col-sm-2">Modificado</dt>
			<dd class="col-sm-10">@cliente.Modificado</dd>
		</dl>
		-->
		<EditForm method="post" Model="cliente" OnValidSubmit="DeleteCliente" FormName="delete" Enhance>
			<div class="d-flex justify-content-around flex-wrap col-md-8">
				<button type="submit" class="btn btn-danger col-md-5 col-12 mb-3" disabled="@(cliente is null)">Delete</button>
				<a href="/clientes" class="btn btn-secondary col-md-5 col-12 mb-3">Back to List</a>
			</div>
		</EditForm>
	}
</div>

@code {
	private Cliente? cliente;

	[SupplyParameterFromQuery]
	private long IdCliente { get; set; }

	protected override async Task OnInitializedAsync()
	{
		cliente = await B007CrudContext.Clientes.FirstOrDefaultAsync(m => m.IdCliente == IdCliente);

		if (cliente is null)
		{
			NavigationManager.NavigateTo("notfound");
		}
	}

	private async Task DeleteCliente()
	{
		B007CrudContext.Clientes.Remove(cliente!);
		await B007CrudContext.SaveChangesAsync();
		NavigationManager.NavigateTo("/clientes");
	}
}
