@page "/clientes"
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.QuickGrid
@using B007Clases.Models
@using B007Clases.Data
@inject B007Clases.Data.B007CrudContext B007CrudContext;
@inject NavigationManager NavigationManager

<PageTitle>Index</PageTitle>

<h1>Index</h1>
<div class="col-md-8">
	<EditForm method="post" Model="Patron" OnValidSubmit="Filtrar" FormName="filtado" Enhance>
		<div class="d-flex justify-content-around">
			<div class="mb-3 col-md-7 col-12">
				<InputText id="patron" @bind-Value="Patron"
				class="form-control" aria-required="true" placeholder="Filtro por Apellidos" />
			</div>
			<button type="submit" class="mb-3 col-md-4 col-12">Filtrar</button>
		</div>
	</EditForm>
</div>
<p>
	<a href="clientes/create" class="btn btn-primary col-md-4 col-12">Create New</a>
</p>

<QuickGrid Class="table" Items="clientes">
	<PropertyColumn Property="cliente => cliente.Nombre" />
	<PropertyColumn Property="cliente => cliente.Apellidos" />
	<PropertyColumn Property="cliente => cliente.Email" />
	<PropertyColumn Property="cliente => cliente.Telefono" />
	<!--
	<PropertyColumn Property="cliente => cliente.FechaAlta" />
	<PropertyColumn Property="cliente => cliente.Creado" />
	<PropertyColumn Property="cliente => cliente.Modificado" />
	-->
	<TemplateColumn Context="cliente">
		<a href="@($"clientes/edit?idcliente={cliente.IdCliente}")">Edit</a> |
		<a href="@($"clientes/details?idcliente={cliente.IdCliente}")">Details</a> |
		<a href="@($"clientes/delete?idcliente={cliente.IdCliente}")">Delete</a>
	</TemplateColumn>
</QuickGrid>

@code {
	private IQueryable<Cliente>? clientes;
	[SupplyParameterFromForm]
	private string Patron { get; set; } = new("");

	protected override void OnInitialized()
	{
		if (string.IsNullOrWhiteSpace(Patron))
		{
			clientes = B007CrudContext.Clientes;
		}
		/*
		else
		{
			clientes = B007CrudContext.Clientes.Where(cliente => cliente.Apellidos.Contains(Patron));
			}*/
	}

	private void Filtrar()
	{
		//NavigationManager.NavigateTo($"/clientes");
		if (!string.IsNullOrWhiteSpace(Patron))
		{
			clientes = B007CrudContext.Clientes.Where(cliente => cliente.Apellidos.Contains(Patron));
		}
	}
}
